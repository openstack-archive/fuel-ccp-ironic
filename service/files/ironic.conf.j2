[DEFAULT]
debug = {{ ironic.logging_debug }}
use_syslog = False
use_stderr = True

my_ip = {{ network_topology["private"]["address"] }}

transport_url = rabbit://{{ rabbitmq.user }}:{{ rabbitmq.password }}@{{ address('rabbitmq') }}:{{ rabbitmq.port }}

enabled_drivers = {{ ironic.enabled_drivers }}

{% if ironic.multitenancy.enable %}
enabled_network_interfaces = noop,flat,neutron
default_network_interface = neutron
{% else %}
enabled_network_interfaces = noop,flat
default_network_interface = flat
{% endif %}

[api]
host_ip = {{ network_topology["private"]["address"] }}
port = {{ ironic.api_port }}

[database]
connection = mysql+pymysql://{{ ironic.db.username }}:{{ ironic.db.password }}@{{ address('mariadb') }}/{{ ironic.db.name }}
max_retries = -1

[keystone_authtoken]
auth_uri = http://{{ address('keystone') }}:{{ keystone.public_port }}
auth_url = http://{{ address('keystone') }}:{{ keystone.admin_port }}
auth_type = password
project_domain_id = default
user_domain_id = default
project_name = service
username = {{ ironic.username }}
password = {{ ironic.password }}
memcached_servers = {{ address('memcached') }}:{{ memcached.port }}

[service_catalog]
auth_type = password
auth_url = http://{{ address('keystone') }}:{{ keystone.public_port }}
project_domain_id = default
user_domain_id = default
project_name = service
username = {{ ironic.username }}
password = {{ ironic.password }}

[conductor]
#(FIXME) ashestakov: api endpoint should be available from provision network
api_url = http://{{ k8s_external_ip }}:{{ ironic.external_port }}
automated_clean = {{ ironic.automated_clean }}

[neutron]
auth_type = password
auth_url = http://{{ address('keystone') }}:{{ keystone.public_port }}
project_domain_id = default
user_domain_id = default
project_name = service
username = {{ ironic.username }}
password = {{ ironic.password }}

url=http://{{ address('neutron-server') }}:{{ neutron.server_port }}
{% if ironic.multitenancy.enable and role_name == 'ironic-conductor' %}
provisioning_network_uuid=___PROVISIONING_UUID___
cleaning_network_uuid=___CLEANING_UUID___
{% endif %}

[glance]
auth_type = password
auth_url = http://{{ address('keystone') }}:{{ keystone.public_port }}
project_domain_id = default
user_domain_id = default
project_name = service
username = {{ ironic.username }}
password = {{ ironic.password }}

glance_host = {{ address('glance-api') }}
glance_port = {{ glance.api_port }}

swift_endpoint_url = http://{{ keystone.swift.radosgw.host }}:{{ keystone.swift.radosgw.port }}
swift_temp_url_key = {{ ironic.swift_temp_url_key }}
temp_url_endpoint_type = radosgw

[pxe]
pxe_append_params = nofb nomodeset vga=normal console=ttyS0 systemd.journald.forward_to_console=yes ipa-debug=1
tftp_root = /var/lib/ironic/tftpboot
tftp_master_path = /var/lib/ironic/tftpboot/master_images
